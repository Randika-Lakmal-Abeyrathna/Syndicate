/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package GUI;

import Classes.JDBC;
import java.awt.Window;
import java.sql.ResultSet;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFrame;
import javax.swing.JOptionPane;

/**
 *
 * @author Uditha N. Bandara
 */
public class LockScreen extends javax.swing.JFrame {

    /**
     * Creates new form LockScreen
     */
    public LockScreen() {
        initComponents();
        this.setExtendedState(MAXIMIZED_BOTH);
        lbl_date.setText(new Classes.Commons().Date());
        new Classes.Commons().time(lbl_time);
        enableButton();
        lbl_userName.setText(GUI.Home.un);
        lbl_userType.setText(GUI.Home.ut);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnl_background = new javax.swing.JPanel();
        lbl_lock = new javax.swing.JLabel();
        lbl_userName = new javax.swing.JLabel();
        lbl_userType = new javax.swing.JLabel();
        lbl_date = new javax.swing.JLabel();
        lbl_time = new javax.swing.JLabel();
        txt_password = new javax.swing.JPasswordField();
        btn_unlock = new javax.swing.JButton();
        lbl_background = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setAlwaysOnTop(true);
        setUndecorated(true);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowOpened(java.awt.event.WindowEvent evt) {
                formWindowOpened(evt);
            }
        });
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        pnl_background.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lbl_lock.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images/lock.png"))); // NOI18N
        pnl_background.add(lbl_lock, new org.netbeans.lib.awtextra.AbsoluteConstraints(427, 10, 512, 512));

        lbl_userName.setFont(new java.awt.Font("Ubuntu", 0, 48)); // NOI18N
        lbl_userName.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lbl_userName.setText("Username");
        lbl_userName.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        pnl_background.add(lbl_userName, new org.netbeans.lib.awtextra.AbsoluteConstraints(483, 500, 400, -1));

        lbl_userType.setFont(new java.awt.Font("Ubuntu", 0, 24)); // NOI18N
        lbl_userType.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lbl_userType.setText("Usertype");
        lbl_userType.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        pnl_background.add(lbl_userType, new org.netbeans.lib.awtextra.AbsoluteConstraints(483, 560, 400, -1));

        lbl_date.setFont(new java.awt.Font("Ubuntu", 0, 48)); // NOI18N
        lbl_date.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbl_date.setText("Date");
        pnl_background.add(lbl_date, new org.netbeans.lib.awtextra.AbsoluteConstraints(877, 20, 470, 40));

        lbl_time.setFont(new java.awt.Font("Ubuntu", 0, 36)); // NOI18N
        lbl_time.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbl_time.setText("Time");
        pnl_background.add(lbl_time, new org.netbeans.lib.awtextra.AbsoluteConstraints(877, 70, 470, 30));

        txt_password.setFont(new java.awt.Font("Ubuntu", 0, 14)); // NOI18N
        txt_password.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        txt_password.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txt_passwordKeyReleased(evt);
            }
        });
        pnl_background.add(txt_password, new org.netbeans.lib.awtextra.AbsoluteConstraints(508, 610, 350, 40));

        btn_unlock.setFont(new java.awt.Font("Ubuntu", 0, 18)); // NOI18N
        btn_unlock.setText("Unlock");
        btn_unlock.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_unlockActionPerformed(evt);
            }
        });
        pnl_background.add(btn_unlock, new org.netbeans.lib.awtextra.AbsoluteConstraints(608, 670, 150, 50));

        lbl_background.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images/Background.png"))); // NOI18N
        pnl_background.add(lbl_background, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1366, 768));

        getContentPane().add(pnl_background, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1366, 768));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btn_unlockActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_unlockActionPerformed
        unlock();
    }//GEN-LAST:event_btn_unlockActionPerformed

    private void txt_passwordKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txt_passwordKeyReleased
        enableButton();
    }//GEN-LAST:event_txt_passwordKeyReleased

    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
        Classes.Commons.FadeIn(this);
    }//GEN-LAST:event_formWindowOpened

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(LockScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(LockScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(LockScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(LockScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new LockScreen().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_unlock;
    private javax.swing.JLabel lbl_background;
    private javax.swing.JLabel lbl_date;
    private javax.swing.JLabel lbl_lock;
    private javax.swing.JLabel lbl_time;
    private javax.swing.JLabel lbl_userName;
    private javax.swing.JLabel lbl_userType;
    private javax.swing.JPanel pnl_background;
    private javax.swing.JPasswordField txt_password;
    // End of variables declaration//GEN-END:variables
    void enableButton() {
        String pw = new String(txt_password.getPassword());
        if (pw.isEmpty()) {
            btn_unlock.setEnabled(false);
        } else {
            btn_unlock.setEnabled(true);
        }
    }

    void unlock() {
        try {
            String un = lbl_userName.getText();
            String pw = new String(txt_password.getPassword());

            ResultSet rs = new JDBC().getData("SELECT user_name, password FROM login WHERE user_name='" + un + "' AND password='" + pw + "'");

            if (rs.next()) {
                String usrn = rs.getString("user_name");
                String pass = rs.getString("password");

                if (usrn.equals(un) && pass.equals(pw)) {
                    Classes.Commons.FadeOut(this);
                    this.dispose();
                    Window[] jf = JFrame.getOwnerlessWindows();
                    for (int i = 0; i < jf.length; i++) {
                        JFrame f = (JFrame) jf[i];
                        Classes.Commons.FadeIn(f);
                    }
                }
            } else {
                JOptionPane.showMessageDialog(this, "Incorrect Password.");
            }
        } catch (Exception ex) {
            Logger.getLogger(LockScreen.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
}
